# åæ€ç³»ç»Ÿå®ç°å®Œæˆæ€»ç»“

## ğŸ‰ å®Œæˆæ¦‚å†µ

åæ€ç³»ç»Ÿå·²å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

### âœ… å·²å®Œæˆæ¨¡å—

1. **å®šæ—¶è°ƒåº¦å™¨** (`backtest/reflection_scheduler.go`)
   - æ¯å‘¨æ—¥ 22:00 è‡ªåŠ¨è§¦å‘
   - æ”¯æŒæ‰‹åŠ¨è§¦å‘åæ€
   - å¹¶å‘æ§åˆ¶ï¼ˆæœ€å¤š 3 ä¸ªå¹¶å‘ï¼‰
   - äº¤æ˜“å‘˜æ³¨å†Œ/æ³¨é”€
   - è‡ªå®šä¹‰åˆ†æå‘¨æœŸ

2. **åæ€åˆ†æå¼•æ“** (`backtest/reflection_engine.go`)
   - äº¤æ˜“å†å²æ•°æ®æŸ¥è¯¢
   - 8+ ç»Ÿè®¡æŒ‡æ ‡è®¡ç®—
   - AI åæ€åˆ†æï¼ˆé€šè¿‡ MCPï¼‰
   - å»ºè®®è‡ªåŠ¨åˆ†ç¦»
   - æ¨¡æ‹Ÿåæ€ç”¨äºæµ‹è¯•

3. **REST API ç«¯ç‚¹** (`api/reflection_handlers.go`)
   - åæ€ç®¡ç†ï¼šæŸ¥è¯¢ã€è¯¦æƒ…ã€æ‰‹åŠ¨è§¦å‘ã€ç»Ÿè®¡
   - å‚æ•°è°ƒæ•´ï¼šæŸ¥çœ‹ã€æ‰¹å‡†ã€æ‹’ç»ã€æ’¤é”€
   - å­¦ä¹ å†…å­˜ï¼šæŸ¥çœ‹ã€å½’æ¡£

4. **æ•°æ®å­˜å‚¨å±‚** (`store/reflection.go` å’Œ `store/reflection_impl.go`)
   - ReflectionRecord æ•°æ®æŒä¹…åŒ–
   - SystemAdjustment å‚æ•°è°ƒæ•´è®°å½•
   - AILearningMemory å­¦ä¹ å†…å­˜å­˜å‚¨
   - 15+ CRUD æ–¹æ³•

5. **AI é›†æˆ**
   - MCP å®¢æˆ·ç«¯æ”¯æŒï¼ˆDeepSeekã€OpenAI ç­‰ï¼‰
   - JSON æ ¼å¼åŒ– AI æç¤º
   - ç½®ä¿¡åº¦å‡†ç¡®ç‡åˆ†ç»„åˆ†æ
   - äº¤æ˜“å¯¹è¡¨ç°åˆ†æ
   - é™çº§å¤„ç†ï¼ˆæ¨¡æ‹Ÿåæ€å¤‡é€‰ï¼‰

## ğŸ“Š ç³»ç»Ÿç»Ÿè®¡

| ç»„ä»¶ | æ–‡ä»¶æ•° | ä»£ç è¡Œæ•° | æè¿° |
|------|--------|---------|------|
| è°ƒåº¦å™¨ | 1 | 280+ | å®šæ—¶ä»»åŠ¡å’Œç®¡ç† |
| å¼•æ“ | 1 | 520+ | åæ€åˆ†ææ ¸å¿ƒé€»è¾‘ |
| API | 1 | 350+ | REST ç«¯ç‚¹å®ç° |
| å­˜å‚¨æ¥å£ | 1 | 134 | æ•°æ®æ¨¡å‹å®šä¹‰ |
| å­˜å‚¨å®ç° | 1 | 342 | GORM æ•°æ®åº“æ“ä½œ |
| **æ€»è®¡** | **5** | **1,600+** | å®Œæ•´ç³»ç»Ÿ |

## ğŸ”§ å…³é”®ç‰¹æ€§

### 1. è‡ªåŠ¨åŒ–åæ€æµç¨‹
```
å®šæ—¶è§¦å‘ â†’ æ•°æ®æŸ¥è¯¢ â†’ æŒ‡æ ‡è®¡ç®— â†’ AI åˆ†æ â†’ å»ºè®®ä¿å­˜ â†’ ç”¨æˆ·å®¡æ‰¹
```

### 2. æ™ºèƒ½å»ºè®®ç³»ç»Ÿ
- **äº¤æ˜“ç³»ç»Ÿå»ºè®®**ï¼šå‚æ•°è°ƒæ•´ï¼ˆä¿¡å¿ƒåº¦ã€æ æ†ã€ä»“ä½ã€æ—¥äºæŸé™åˆ¶ï¼‰
- **AI å­¦ä¹ å»ºè®®**ï¼šç»éªŒè®°å¿†ã€æ¨¡å¼è¯†åˆ«ã€åå·®è¯†åˆ«ã€é£é™©è­¦å‘Š

### 3. æ•°æ®é©±åŠ¨åˆ†æ
è®¡ç®—çš„ 8+ æŒ‡æ ‡ï¼š
- æˆåŠŸç‡ / å¤±è´¥ç‡
- å¹³å‡ PnL
- æœ€å¤§æ”¶ç›Š / æœ€å¤§æŸå¤±
- Sharpe æ¯”ç‡
- æœ€å¤§å›æ’¤
- ä¿¡å¿ƒåº¦å‡†ç¡®ç‡ï¼ˆæŒ‰ç½®ä¿¡åº¦åŒºé—´åˆ†ç»„ï¼‰
- äº¤æ˜“å¯¹è¡¨ç°ï¼ˆæŒ‰è´§å¸å¯¹ç»†åˆ†ï¼‰

### 4. ç”¨æˆ·å®¡æ‰¹å·¥ä½œæµ
```
åæ€ç”Ÿæˆ (PENDING)
    â†“
ç”¨æˆ·æŸ¥çœ‹ API
    â†“
    â”œâ”€ æ‰¹å‡† â†’ APPLIED
    â”œâ”€ æ‹’ç» â†’ REJECTED
    â””â”€ æ’¤é”€ â†’ REVERTED
```

### 5. å­¦ä¹ å†…å­˜æ³¨å…¥
```
å†å²ç»éªŒåº“ â†’ AI ä¸‹æ¬¡å†³ç­– â†’ æ›´å¥½çš„åˆ†æ
(prompt injection)
```

## ğŸ“¡ API ç«¯ç‚¹æ¸…å•

### åæ€ç®¡ç†
- `GET /api/reflection/{traderID}/recent` - æœ€è¿‘åæ€
- `GET /api/reflection/{id}` - åæ€è¯¦æƒ…
- `POST /api/reflection/{traderID}/analyze` - æ‰‹åŠ¨è§¦å‘
- `GET /api/reflection/{traderID}/stats` - ç»Ÿè®¡ä¿¡æ¯

### å‚æ•°è°ƒæ•´
- `GET /api/adjustment/{traderID}/pending` - å¾…å®¡æ‰¹
- `POST /api/adjustment/{id}/apply` - æ‰¹å‡†
- `POST /api/adjustment/{id}/reject` - æ‹’ç»
- `POST /api/adjustment/{id}/revert` - æ’¤é”€
- `GET /api/adjustment/{traderID}/history` - å†å²è®°å½•

### å­¦ä¹ å†…å­˜
- `GET /api/memory/{traderID}` - æŸ¥çœ‹å†…å­˜
- `DELETE /api/memory/{id}` - å½’æ¡£å†…å­˜

## ğŸ“ˆ æ•°æ®åº“æ¶æ„

### è¡¨ç»“æ„
```sql
-- åæ€è®°å½•è¡¨
reflections (
  id, trader_id, reflection_time,
  total_trades, success_rate, total_pnl, sharpe_ratio, max_drawdown,
  confidence_accuracy (JSON), symbol_performance (JSON),
  ai_reflection (TEXT), trade_system_advice, ai_learning_advice
)

-- å‚æ•°è°ƒæ•´è¡¨
system_adjustments (
  id, trader_id, reflection_id, adjustment_time,
  confidence_level, leverage, max_position_size, max_daily_loss,
  reason (TEXT), status, applied_at
)

-- AI å­¦ä¹ å†…å­˜è¡¨
ai_learning_memory (
  id, trader_id, reflection_id,
  memory_type, symbol, content (TEXT),
  confidence, usage_count, last_used_at,
  prompt_injection (TEXT), expires_at
)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¼–è¯‘æ£€æŸ¥
```bash
cd nofx
go build -o /dev/null main.go  # âœ… é€šè¿‡
```

### 2. é›†æˆåˆ°åº”ç”¨
```go
// åˆå§‹åŒ–åæ€ç³»ç»Ÿ
reflectionScheduler := backtest.NewReflectionScheduler(engine, store)
reflectionScheduler.RegisterTrader(traderID)
reflectionScheduler.Start()

// æ³¨å†Œ API è·¯ç”±
handlers := api.NewReflectionHandlers(reflectionScheduler, store)
handlers.RegisterReflectionRoutes(router)

// å…³é—­
defer reflectionScheduler.Stop()
```

### 3. æ‰‹åŠ¨è§¦å‘åæ€
```bash
curl -X POST http://localhost:8080/api/reflection/trader_123/analyze
```

### 4. æŸ¥çœ‹å¾…å®¡æ‰¹è°ƒæ•´
```bash
curl http://localhost:8080/api/adjustment/trader_123/pending
```

### 5. æ‰¹å‡†è°ƒæ•´
```bash
curl -X POST http://localhost:8080/api/adjustment/adj_456/apply
```

## ğŸ“š æ–‡æ¡£

- **[åæ€ç³»ç»Ÿå®ç°æŒ‡å—](REFLECTION_SYSTEM_IMPLEMENTATION.md)** - è¯¦ç»†çš„éƒ¨ç½²å’Œé…ç½®æŒ‡å—
- **[åæ€ç³»ç»Ÿé›†æˆç¤ºä¾‹](reflection_integration_example.go)** - ä»£ç é›†æˆç¤ºä¾‹

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸ (ä¼˜å…ˆçº§: é«˜)
- [ ] åœ¨ main.go ä¸­åˆå§‹åŒ–åæ€è°ƒåº¦å™¨
- [ ] æ³¨å†Œåæ€ API è·¯ç”±åˆ° HTTP æœåŠ¡å™¨
- [ ] æ‰§è¡Œç«¯åˆ°ç«¯æµ‹è¯•
- [ ] è®¾ç½®ç”Ÿäº§æ—¥å¿—çº§åˆ«

### ä¸­æœŸ (ä¼˜å…ˆçº§: ä¸­)
- [ ] å®ç°å‰ç«¯ä»ªè¡¨æ¿ï¼ˆReact ç»„ä»¶ï¼‰
- [ ] æ·»åŠ é‚®ä»¶/Webhook é€šçŸ¥
- [ ] é›†æˆå­¦ä¹ å†…å­˜åˆ° AI æç¤ºä¸­
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### é•¿æœŸ (ä¼˜å…ˆçº§: ä½)
- [ ] æ”¯æŒé«˜çº§ Cron è°ƒåº¦
- [ ] å®ç°å®¡è®¡æ—¥å¿—ç³»ç»Ÿ
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆæ‰¹é‡æ“ä½œã€ç¼“å­˜ï¼‰
- [ ] æ”¯æŒè‡ªå®šä¹‰åæ€ç­–ç•¥

## âš™ï¸ ç³»ç»Ÿè¦æ±‚

- **Go ç‰ˆæœ¬**: 1.18+ (å½“å‰ä½¿ç”¨ 1.25.3)
- **æ•°æ®åº“**: SQLite / PostgreSQLï¼ˆGORM å…¼å®¹ï¼‰
- **AI å®¢æˆ·ç«¯**: MCP åè®®å®ç°ï¼ˆDeepSeekã€OpenAI ç­‰ï¼‰
- **ä¾èµ–åŒ…**: gorm.io/gorm, github.com/gin-gonic/gin

## ğŸ” å®‰å…¨è€ƒè™‘

- âœ… å‚æ•°è°ƒæ•´éœ€è¦ç”¨æˆ·å®¡æ‰¹ï¼ˆé˜²æ­¢è‡ªåŠ¨è¯¯è°ƒï¼‰
- âœ… å­¦ä¹ å†…å­˜æœ‰è¿‡æœŸæ—¶é—´ï¼ˆ30 å¤©ï¼‰
- âœ… ä½ç½®ä¿¡åº¦å­¦ä¹ å†…å­˜ä¸ä¼šæ³¨å…¥æç¤ºï¼ˆconfidence < 0.6ï¼‰
- âœ… æ‰€æœ‰ API æ“ä½œåº”æ·»åŠ è®¤è¯ï¼ˆå¾…å®ç°ï¼‰
- âœ… æ•æ„Ÿå‚æ•°åº”åŠ å¯†å­˜å‚¨ï¼ˆå¾…å¢å¼ºï¼‰

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. æ‰‹åŠ¨è§¦å‘åæ€
å½“éœ€è¦ç«‹å³åˆ†æäº¤æ˜“æ•°æ®æ—¶ï¼Œä½¿ç”¨ API ç«¯ç‚¹è€Œä¸éœ€è¦ç­‰å¾…å®šæ—¶è§¦å‘ã€‚

### 2. å®¡æŸ¥ç»Ÿè®¡æ•°æ®
ä½¿ç”¨ `/stats` ç«¯ç‚¹å¿«é€Ÿäº†è§£äº¤æ˜“è¡¨ç°ï¼š
- è¯†åˆ«å“ªäº›äº¤æ˜“å¯¹è¡¨ç°å¥½
- å‘ç°ä¿¡å¿ƒåº¦è¿‡é«˜çš„é—®é¢˜
- è·Ÿè¸ª Sharpe æ¯”ç‡è¶‹åŠ¿

### 3. ç®¡ç†å­¦ä¹ å†…å­˜
å®šæœŸæŸ¥çœ‹å­¦ä¹ å†…å­˜ï¼Œåˆ é™¤è¿‡æ—¶æˆ–ä¸å‡†ç¡®çš„å†…å®¹ã€‚

### 4. AB æµ‹è¯•è°ƒæ•´
æ‰¹å‡†ä¸€ä¸ªè°ƒæ•´åï¼Œè§‚å¯Ÿå…¶å¯¹äº¤æ˜“è¡¨ç°çš„å½±å“ã€‚å¦‚æœä¸å¥½ï¼Œä½¿ç”¨æ’¤é”€åŠŸèƒ½ã€‚

## ğŸ“ æ”¯æŒå’Œåé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–åŠŸèƒ½è¯·æ±‚ï¼Œè¯·ï¼š
1. æ£€æŸ¥ [å®ç°æŒ‡å—](REFLECTION_SYSTEM_IMPLEMENTATION.md)
2. æŸ¥çœ‹ [ç¤ºä¾‹ä»£ç ](reflection_integration_example.go)
3. æŸ¥é˜… API ç«¯ç‚¹æ–‡æ¡£
4. è”ç³»å¼€å‘å›¢é˜Ÿ

## ğŸ“ å˜æ›´æ—¥å¿—

### v1.0.0 (2024-01-15)
- âœ… åˆå§‹åŒ–åæ€ç³»ç»Ÿ
- âœ… å®ç°å®šæ—¶è°ƒåº¦å™¨
- âœ… å®Œæˆåæ€åˆ†æå¼•æ“
- âœ… æä¾›å®Œæ•´ REST API
- âœ… AI é›†æˆå’Œå»ºè®®åˆ†ç¦»
- âœ… æ•°æ®å­˜å‚¨å®ç°
- âœ… å®Œæ•´æ–‡æ¡£å’Œç¤ºä¾‹

---

**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª  
**ç¼–è¯‘**: âœ… é€šè¿‡  
**æµ‹è¯•**: â³ å¾…æ‰§è¡Œ  
**éƒ¨ç½²**: â³ å¾…é›†æˆåˆ° main.go
