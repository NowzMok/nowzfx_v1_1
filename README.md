# NOFX V1.1 å®Œæ•´ç¦»çº¿å®‰è£…åŒ…

## ğŸ“¦ åŒ…ç»“æ„

```
nowzfx_v1_1/
â”œâ”€â”€ source/                    # æºä»£ç ç›®å½•
â”‚   â””â”€â”€ nofx/                 # å®Œæ•´çš„ NOFX é¡¹ç›®æºä»£ç 
â”‚       â”œâ”€â”€ api/              # API æ¥å£
â”‚       â”œâ”€â”€ auth/             # è®¤è¯æ¨¡å—
â”‚       â”œâ”€â”€ web/              # å‰ç«¯åº”ç”¨
â”‚       â”œâ”€â”€ docker/           # Docker é…ç½®
â”‚       â”œâ”€â”€ go.mod            # Go æ¨¡å—æ–‡ä»¶
â”‚       â””â”€â”€ ...
â”œâ”€â”€ scripts/                   # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ prepare_offline_build.sh    # å‡†å¤‡ç¦»çº¿æ„å»ºç¯å¢ƒ
â”‚   â”œâ”€â”€ build_backend.sh            # æ„å»º Go åç«¯
â”‚   â”œâ”€â”€ build_frontend.sh           # æ„å»º Node.js å‰ç«¯
â”‚   â”œâ”€â”€ build_docker_images.sh      # æ„å»º Docker é•œåƒ
â”‚   â”œâ”€â”€ install.sh                  # å®Œæ•´å®‰è£…è„šæœ¬
â”‚   â””â”€â”€ uninstall.sh                # å¸è½½è„šæœ¬
â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ .env.example          # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ docker_images/            # Docker é•œåƒå­˜å‚¨ï¼ˆåˆæœŸä¸ºç©ºï¼‰
â”œâ”€â”€ build/                     # æ„å»ºè¾“å‡ºç›®å½•ï¼ˆç”±è„šæœ¬åˆ›å»ºï¼‰
â”œâ”€â”€ data/                      # åº”ç”¨æ•°æ®ç›®å½•ï¼ˆç”±è„šæœ¬åˆ›å»ºï¼‰
â”œâ”€â”€ docker-compose.yml         # Docker Compose é…ç½®
â””â”€â”€ README.md                  # æœ¬æ–‡ä»¶

```

## âœ… ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚
- **CPU**: 2æ ¸ æˆ–æ›´é«˜
- **å†…å­˜**: 4GB æˆ–æ›´é«˜
- **ç£ç›˜**: 20GB æˆ–æ›´é«˜ï¼ˆåŒ…å«æ„å»ºå’Œè¿è¡Œï¼‰
- **ç½‘ç»œ**: é¦–æ¬¡å®‰è£…éœ€è¦ç½‘ç»œä¸‹è½½ä¾èµ–ï¼ˆåç»­æ“ä½œå¯ç¦»çº¿ï¼‰

### è½¯ä»¶è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Linux, macOS, æˆ– Windows (WSL2)
- **Docker**: 20.10 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Docker Compose**: 2.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Go**: 1.25 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆç”¨äºæ„å»ºåç«¯ï¼‰
- **Node.js**: 20 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆç”¨äºæ„å»ºå‰ç«¯ï¼‰
- **Git**: ç”¨äºè·å–æºä»£ç ï¼ˆå¯é€‰ï¼‰

## ğŸš€ å¿«é€Ÿå®‰è£…ï¼ˆ3 æ­¥ï¼‰

### æ­¥éª¤ 1: è¿›å…¥åŒ…ç›®å½•

```bash
cd nowzfx_v1_1
```

### æ­¥éª¤ 2: èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™

```bash
chmod +x scripts/*.sh
```

### æ­¥éª¤ 3: è¿è¡Œå®Œæ•´å®‰è£…

```bash
# å¦‚æœéœ€è¦ root æƒé™
sudo bash scripts/install.sh

# æˆ–è€…ç›´æ¥è¿è¡Œï¼ˆæŸäº›å‘½ä»¤å¯èƒ½éœ€è¦ sudoï¼‰
bash scripts/install.sh
```

å®‰è£…è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹æ“ä½œï¼š
1. å‡†å¤‡æ„å»ºç¯å¢ƒ
2. ç¼–è¯‘ Go åç«¯
3. ç¼–è¯‘ Node.js å‰ç«¯
4. æ„å»º Docker é•œåƒ
5. å¯åŠ¨ Docker Compose æœåŠ¡

## ğŸ“‹ åˆ†æ­¥å®‰è£…ï¼ˆæ‰‹åŠ¨æ“ä½œï¼‰

å¦‚æœæ‚¨æƒ³é€æ­¥æ§åˆ¶å®‰è£…è¿‡ç¨‹ï¼Œå¯ä»¥åˆ†åˆ«è¿è¡Œä»¥ä¸‹è„šæœ¬ï¼š

### 1. å‡†å¤‡ç¦»çº¿æ„å»º

```bash
bash scripts/prepare_offline_build.sh
```

è¿™ä¼šæ£€æŸ¥å¹¶å‡†å¤‡æ‰€æœ‰æ„å»ºä¾èµ–ã€‚

### 2. æ„å»º Go åç«¯

```bash
bash scripts/build_backend.sh
```

è¾“å‡ºæ–‡ä»¶ä½ç½®: `build/backend/nofx-server`

### 3. æ„å»º Node.js å‰ç«¯

```bash
bash scripts/build_frontend.sh
```

è¾“å‡ºæ–‡ä»¶ä½ç½®: `build/frontend/dist/`

### 4. æ„å»º Docker é•œåƒ

```bash
bash scripts/build_docker_images.sh
```

è¿™ä¼šï¼š
- æ„å»ºåç«¯é•œåƒ (nofx-backend:latest)
- æ„å»ºå‰ç«¯é•œåƒ (nofx-frontend:latest)
- å¯¼å‡ºä¸º tar.gz æ–‡ä»¶åˆ° `docker_images/` ç›®å½•

### 5. å¯åŠ¨æœåŠ¡

```bash
docker-compose up -d
```

### 6. éªŒè¯æœåŠ¡

```bash
docker-compose ps
docker-compose logs
```

## ğŸŒ è®¿é—®åº”ç”¨

å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®åº”ç”¨ï¼š

- **å‰ç«¯**: http://localhost:3000
- **åç«¯ API**: http://localhost:8080
- **API æ–‡æ¡£**: http://localhost:8080/docs (å¦‚æœåç«¯æä¾›)

## âš™ï¸ é…ç½®æ–‡ä»¶

### ç¯å¢ƒå˜é‡ (.env)

é¦–æ¬¡å®‰è£…æ—¶ï¼Œè¯·æ ¹æ®éœ€è¦ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„é…ç½®ï¼š

```bash
# ä»æ¨¡æ¿å¤åˆ¶
cp config/.env.example .env

# ç¼–è¾‘é…ç½®
nano .env
```

**é‡è¦é…ç½®é¡¹**ï¼š

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| JWT_SECRET | JWT ç­¾åå¯†é’¥ | change-me-... |
| DATA_ENCRYPTION_KEY | æ•°æ®åŠ å¯†å¯†é’¥ | change-me-... |
| DB_TYPE | æ•°æ®åº“ç±»å‹ | sqlite |
| DB_PATH | æ•°æ®åº“è·¯å¾„ | /app/data/data.db |
| LOG_LEVEL | æ—¥å¿—çº§åˆ« | info |
| TZ | æ—¶åŒº | Asia/Shanghai |

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### Docker Compose å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f nofx-backend

# å¯åŠ¨æœåŠ¡
docker-compose start

# åœæ­¢æœåŠ¡
docker-compose stop

# é‡å¯æœåŠ¡
docker-compose restart

# åˆ é™¤å®¹å™¨ï¼ˆä¿ç•™é•œåƒå’Œæ•°æ®ï¼‰
docker-compose down

# å®Œæ•´å¸è½½
bash scripts/uninstall.sh
```

### Docker å‘½ä»¤

```bash
# æŸ¥çœ‹é•œåƒ
docker images | grep nofx

# æŸ¥çœ‹å®¹å™¨
docker ps -a | grep nofx

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs nofx-backend
docker logs nofx-frontend

# è¿›å…¥å®¹å™¨
docker exec -it nofx-backend /bin/bash
docker exec -it nofx-frontend /bin/bash
```

## ğŸ“Š æ•°æ®ç®¡ç†

### æ•°æ®å­˜å‚¨ä½ç½®

æ‰€æœ‰åº”ç”¨æ•°æ®å­˜å‚¨åœ¨ `data/` ç›®å½•ä¸­ï¼š

```
data/
â”œâ”€â”€ data.db          # SQLite æ•°æ®åº“æ–‡ä»¶
â””â”€â”€ logs/            # æ—¥å¿—æ–‡ä»¶ï¼ˆå¦‚æœé…ç½®ï¼‰
```

### å¤‡ä»½æ•°æ®

```bash
# å¤‡ä»½æ•´ä¸ªæ•°æ®ç›®å½•
cp -r data data.backup-$(date +%Y%m%d-%H%M%S)

# ä»…å¤‡ä»½æ•°æ®åº“
cp data/data.db data/data.db.backup
```

### è¿˜åŸæ•°æ®

```bash
# åœæ­¢æœåŠ¡
docker-compose down

# è¿˜åŸæ•°æ®
cp -r data.backup-20240114-120000/* data/

# é‡å¯æœåŠ¡
docker-compose up -d
```

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ 1: Docker é•œåƒæ„å»ºå¤±è´¥

**ç—‡çŠ¶**: `docker build` å‘½ä»¤å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ Docker å®ˆæŠ¤è¿›ç¨‹æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—: `docker build ... --progress=plain`

### é—®é¢˜ 2: ä¾èµ–ä¸‹è½½å¤±è´¥

**ç—‡çŠ¶**: npm æˆ– go mod ä¸‹è½½å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ï¼ˆé¦–æ¬¡æ„å»ºéœ€è¦ç½‘ç»œï¼‰
2. å°è¯•æ¸…é™¤ç¼“å­˜: `npm cache clean --force`
3. ä½¿ç”¨å®˜æ–¹æºè€Œä¸æ˜¯é•œåƒæº

### é—®é¢˜ 3: ç«¯å£å·²è¢«å ç”¨

**ç—‡çŠ¶**: `bind: address already in use`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :3000
lsof -i :8080

# ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„
# æˆ–åœæ­¢å ç”¨è¯¥ç«¯å£çš„æœåŠ¡
```

### é—®é¢˜ 4: æƒé™é”™è¯¯

**ç—‡çŠ¶**: `Permission denied` é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™
chmod +x scripts/*.sh

# æˆ–ä½¿ç”¨ sudo è¿è¡Œ
sudo bash scripts/install.sh
```

## ğŸ“š æ–‡ä»¶è¯´æ˜

### è„šæœ¬æ–‡ä»¶

| è„šæœ¬ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| prepare_offline_build.sh | å‡†å¤‡æ„å»ºç¯å¢ƒ | æ£€æŸ¥ä¾èµ–ï¼Œä¸‹è½½æ¨¡å— |
| build_backend.sh | æ„å»ºåç«¯ | ç¼–è¯‘ Go ç¨‹åº |
| build_frontend.sh | æ„å»ºå‰ç«¯ | ç¼–è¯‘ Node.js åº”ç”¨ |
| build_docker_images.sh | æ„å»ºé•œåƒ | Docker é•œåƒæ„å»ºå’Œå¯¼å‡º |
| install.sh | å®Œæ•´å®‰è£… | ä¸€é”®å®‰è£…æ‰€æœ‰ç»„ä»¶ |
| uninstall.sh | å¸è½½ | åˆ é™¤å®¹å™¨å’Œé•œåƒï¼Œä¿ç•™æ•°æ® |

### é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| docker-compose.yml | Docker ç¼–æ’ | å®šä¹‰æœåŠ¡å’Œç½‘ç»œ |
| config/.env.example | ç¯å¢ƒå˜é‡æ¨¡æ¿ | å¤åˆ¶ä¸º .env ä½¿ç”¨ |

## ğŸ” å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†é’¥**
   ```bash
   # ç”Ÿæˆå¼ºå¯†é’¥
   openssl rand -base64 32
   
   # æ›´æ–° .env æ–‡ä»¶ä¸­çš„ JWT_SECRET å’Œ DATA_ENCRYPTION_KEY
   ```

2. **å®šæœŸå¤‡ä»½**
   - å¤‡ä»½ `data/` ç›®å½•
   - å¤‡ä»½ `.env` æ–‡ä»¶ï¼ˆä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼‰

3. **ç½‘ç»œéš”ç¦»**
   - åœ¨ç¦»çº¿ç¯å¢ƒä¸­è¿è¡Œæ—¶ï¼Œç¡®ä¿ç½‘ç»œç‰©ç†éš”ç¦»
   - å¦‚éœ€è”ç½‘ï¼Œä½¿ç”¨é˜²ç«å¢™é™åˆ¶è®¿é—®

4. **æ›´æ–°ä¾èµ–**
   - å®šæœŸæ£€æŸ¥å®‰å…¨æ›´æ–°
   - é‡å»º Docker é•œåƒä»¥åŒ…å«æœ€æ–°è¡¥ä¸

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š

1. æŸ¥çœ‹å®Œæ•´æ—¥å¿—: `docker-compose logs -f`
2. æ£€æŸ¥æºé¡¹ç›®æ–‡æ¡£ï¼ˆsource/nofx/ ä¸­çš„ README.mdï¼‰
3. æŸ¥é˜… Docker å®˜æ–¹æ–‡æ¡£

## ğŸ“ ç‰ˆæœ¬ä¿¡æ¯

- **åŒ…ç‰ˆæœ¬**: 1.1
- **NOFX ç‰ˆæœ¬**: 1.0.0
- **åˆ›å»ºæ—¥æœŸ**: 2026-01-14
- **æ”¯æŒå¹³å°**: Linux, macOS, Windows (WSL2)

---

**æ³¨æ„**: è¿™ä¸ªå®Œæ•´ç¦»çº¿å®‰è£…åŒ…åŒ…å«äº†æ‰€æœ‰æºä»£ç ã€‚é¦–æ¬¡å®‰è£…æ—¶éœ€è¦ç½‘ç»œè¿æ¥ä»¥ä¸‹è½½ä¾èµ–ï¼ˆGo modules, npm packagesï¼‰ã€‚æ­¤åçš„å®‰è£…å’Œæ›´æ–°å¯ä»¥åœ¨å®Œå…¨ç¦»çº¿çš„ç¯å¢ƒä¸­è¿›è¡Œã€‚
